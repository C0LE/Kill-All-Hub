local running = false -- Script starts as inactive

local function toggleAttack()
    running = not running -- Toggle between true and false
    print(running and "Attack started!" or "Attack stopped!")

    if running then
        spawn(function()
            while running do
                -- Start checking players only when running is true
                for _, player in pairs(game:GetService("Players"):GetPlayers()) do
                    pcall(function()
                        local localPlayer = game:GetService("Players").LocalPlayer
                        local enemyChar = player.Character
                        local localChar = localPlayer.Character
                        
                        if player ~= localPlayer 
                        and enemyChar 
                        and localChar 
                        and enemyChar:FindFirstChild("HumanoidRootPart") 
                        and localChar:FindFirstChild("HumanoidRootPart") 
                        and not enemyChar:FindFirstChildOfClass("ForceField") 
                        and enemyChar:FindFirstChildOfClass("Humanoid").Health > 0 then

                            repeat
                                wait(0.1)
                                localChar.HumanoidRootPart.CFrame = enemyChar.HumanoidRootPart.CFrame

                                for _, target in pairs(game:GetService("Players"):GetPlayers()) do
                                    if target ~= localPlayer and target.Character then
                                        game.ReplicatedStorage.meleeEvent:FireServer(target)
                                    end
                                end
                            until not running 
                                or not enemyChar 
                                or not enemyChar:FindFirstChildOfClass("Humanoid") 
                                or enemyChar:FindFirstChildOfClass("Humanoid").Health <= 0

                            break -- Stop after attacking one player
                        end
                    end)
                end
                wait(0.1) -- Small wait to prevent script from overloading the server
            end
        end)
    end
end

-- Keybind: Press "K" to start/stop
game:GetService("UserInputService").InputBegan:Connect(function(input, processed)
    if not processed and input.KeyCode == Enum.KeyCode.K then
        toggleAttack() -- Trigger start/stop on "K" key press
    end
end)
